# test-task-for-avitotech
Тестовое задание для 2ого этапа отборочных на стажировку 

<h2>Стек сервиса</h2>
<ul>
  <li>Goland (http фреймворк gin)</li>
  <li>Postgresql</li>
  <li>Docker, Docker-compose</li>
</ul>


<h2>Запуск приложения и работа с ним</h2>
<ul>
  <li>Для запуска данного API используется docker и docker-compose. В файле <b>.env</b> находятся все необходимые переменные окружения, в случае, если необходимо задать собственные переменные окружения, лучше это делать именно в файле <b>.env</b></li>
  <li>Для запуска приложения в корне проекта введите команду <b>make</b>, она запустит <b>docker-compose up -d</b></li>
  <li>В случае, если необходимо удалить контейнеры api и образ golang приложения введите <b>make clean</b></li>
  <li>Для быстрого подключения к базе данных введите <b>make conn_to_db</b></li>
</ul>
<h2>Реализованый дополнительный функционал</h2>
<ul>
    <li>Ведение истории пользователя и её отображение в формате .csv</li>
    <li>Автоматизация связывания пользователей и сегментов с указанием процента пользователей или с указанием linitt, offset, rand</li>
    <li>Реализованы swagger документация и клиент. Swagger клиент доступен только если ENV != prod</li>
    <li>Написаны unit тесты для сервисов с использование mock</li>
</ul>
<h2>Сценарий использования API</h2>
Данное api предназначено для регистрации экспериментальных сигментов и распределения пользователей по ним. Для тогда чтобы связать пользователей и сегменты, сначала необходимо зарегестрировать пользователей в сервисе.<br>
<h2>Запросы для работы с сегментами</h2>
Для регистрации сигментов используемая запрос:<br>
Post /segment<br>
{
  "name": "string"
}
<hr>
Для удаления:<br>
Delete /segmen<br>
{
  "name": "string"
}
<hr>
Для переименовывания:<br>
Put /segment<br>
{
  "id": 0,
  "new_name": "string"
}
<hr>
Для получения всех сигментов:<br>
Get /segment/all<br>
<hr>

<h2>Запросы для работы с пользователями</h2>
Регистрация пользователей<br>
Данный запрос принимает несколько id пользователей, в случае если некоторые id уже зарегистрированы в сервисе, они будут проигнорированы.<br>
Post /user/add<br>

{
  "ids": [
    0
  ]
}
<hr>
Для удаления пользователей по их id:<br>
Если некоторых id нет в базе данных, они будут проигнорированы.<br>
Delete /user<br>
{
  "ids": [
    0
  ]
}<br>

<hr>
Получить пользователей можно 2 способома:<br>
С заданием limit, offset, rand<br>
Post /uset/get<br>
{
  "limit": 0,
  "offset": 0,
  "random": true
}
<hr>
С заданием процента от общего числа пользователей:<br>
Post /user/get/percent<br>
{
  "persent": 0
}

<h2>Запросы для работы со связями пользователей и сегметами</h2>
Для связи пользователей и сегментов есть несколько запросов:<br>
Для одного пользователя добавляем несколько сегментов <br>
Post /user_in_segment/add/one<br>
{
  "segment_names": [
    "string"
  ],
  "user_id": 0
}
<hr>
Для нескольких пользователей - несколько секторов<br>
Post /uset_in_segmebt/add/many<br>
{
  "segment_names": [
    "string"
  ],
  "user_ids": [
    0
  ]
}
<hr>
Для связи процента пользователей и сегментов (берутся только пользователи, которые не находятся в данных сегментах, если нет достаточного количества пользователей, то их будет зарегистрировано меньше, чем требовалось)<br>
Post /uset_in_segment/add/percent<br>
{
  "persent": 0,
  "segment_names": [
    "string"
  ]
}
<hr>
Для связи пользователей с учётом limit, offset, rand и сегмениами (если нет необходимого количества пользователей не участвующих в сегментах, будет взято меньшее количество пользователей) <br>
Post /user_in_segment/add/params<br>
{
  "limit": 0,
  "offset": 0,
  "random": true,
  "segment_names": [
    "string"
  ]
}
<hr>
Для удаления пользователей из сегментов:<br>
Delete /user_in_segment<br>
{
  "segment_names": [
    "string"
  ],
  "user_id": 0
}
<hr>
Для получения всех сегментов, в которых участвует пользователь:<br>
Post /user_in_segment/get/user<br>
{
  "id": 0
}
<hr>
Для получения всех пользователей в сегменте:<br>
Post /user_in_segment/get/segment<br>
{
  "name": "string"
}
<h2>Запросы для работы с историей</h2>
Для получения истории пользователя за определенный месяц определённого года в формате csv файла:<br>
Post /history
{
  "month": 0,
  "user_id": 0,
  "year": 0
}

